# API — Guía para el equipo de Frontend\n+\n+Este documento describe cada endpoint, qué recibe (headers / body), qué devuelve y ejemplos para que tu desarrollador pueda conectar el front.\n+\n+Base URL (local): `http://localhost:3000`\n+\n+Autenticación\n+- Tipo: JWT en header `Authorization: Bearer <token>`\n+- El token se obtiene al hacer `POST /api/auth/login` o `POST /api/auth/register`.\n+\n+Formato de respuesta (consistente)\n+- Éxito:\n+\n+```json\n+{\n+  \"success\": true,\n+  \"data\": { /* objeto o lista */ },\n+  \"meta\": { /* opcional */ }\n+}\n+```\n+\n+- Error:\n+\n+```json\n+{\n+  \"success\": false,\n+  \"error\": {\n+    \"message\": \"Mensaje legible\",\n+    \"code\": \"ERROR_CODE\",\n+    \"details\": { /* opcional */ }\n+  }\n+}\n+```\n+\n+Reglas importantes\n+- Passwords: mínimo 8 caracteres, al menos una mayúscula, un número y un carácter especial. Ejemplo válido: `Abcdef1!`\n+- Los endpoints protegidos requieren header: `Authorization: Bearer <token>`\n+\n+-----------------------------------------------------------------\n+1) Registro de usuario\n+\n+- URL: `POST /api/auth/register`\n+- Auth: No\n+- Headers: `Content-Type: application/json`\n+- Body (JSON):\n+\n+```json\n+{\n+  \"name\": \"Nombre Completo\",\n+  \"email\": \"usuario@example.com\",\n+  \"password\": \"Abcdef1!\"\n+}\n+```\n+\n+- Success (201):\n+\n+```json\n+{\n+  \"success\": true,\n+  \"data\": {\n+    \"token\": \"<jwt>\",\n+    \"user\": { \"id\":\"...\", \"name\":\"...\", \"email\":\"...\" }\n+  }\n+}\n+```\n+\n+- Errores comunes:\n+  - 409 USER_ALREADY_EXISTS\n+  - 422 WEAK_PASSWORD (detalle en `error.details` si corresponde)\n+\n+Fetch (ejemplo):\n+\n+```javascript\n+fetch('/api/auth/register', {\n+  method: 'POST',\n+  headers: { 'Content-Type': 'application/json' },\n+  body: JSON.stringify({ name, email, password })\n+})\n+```\n+\n+-----------------------------------------------------------------\n+2) Login\n+\n+- URL: `POST /api/auth/login`\n+- Auth: No\n+- Body (JSON):\n+\n+```json\n+{ \"email\": \"usuario@example.com\", \"password\": \"Abcdef1!\" }\n+```\n+\n+- Success (200): devuelve `{ token, user }` en `data`.\n+- Error 401: INVALID_CREDENTIALS\n+\n+Fetch (ejemplo):\n+\n+```javascript\n+const res = await fetch('/api/auth/login', {\n+  method: 'POST', headers: { 'Content-Type': 'application/json' },\n+  body: JSON.stringify({ email, password })\n+});\n+const json = await res.json();\n+// guardar json.data.token en localStorage/session según convenga\n+```\n+\n+-----------------------------------------------------------------\n+3) Obtener perfil\n+\n+- URL: `GET /api/auth/profile`\n+- Auth: Sí\n+- Headers: `Authorization: Bearer <token>`\n+- Success (200): `data` contiene el usuario (sin password)\n+\n+Fetch:\n+\n+```javascript\n+fetch('/api/auth/profile', { headers: { Authorization: `Bearer ${token}` } })\n+```\n+\n+-----------------------------------------------------------------\n+4) Cambiar contraseña\n+\n+- URL: `PUT /api/auth/change-password`\n+- Auth: Sí\n+- Body (JSON):\n+\n+```json\n+{ \"currentPassword\": \"Old1!\", \"newPassword\": \"NewPass1!\" }\n+```\n+\n+- Validaciones: `newPassword` debe cumplir la política.\n+- Success (200): mensaje de confirmación en `data`.\n+- Errores: 400 MISSING_FIELDS, 401 INVALID_CREDENTIALS, 422 WEAK_PASSWORD\n+\n+-----------------------------------------------------------------\n+5) Listar todos\n+\n+- URL: `GET /api/todos`\n+- Auth: Sí\n+- Query params: ninguno por ahora (se puede ampliar)\n+- Success (200): `data` = array de todos del usuario\n+\n+-----------------------------------------------------------------\n+6) Crear todo\n+\n+- URL: `POST /api/todos`\n+- Auth: Sí\n+- Body (JSON):\n+\n+```json\n+{ \"title\": \"Comprar leche\", \"completed\": false }\n+```\n+\n+- Validaciones: `title` requerido\n+- Success (201): devuelve el objeto creado en `data`\n+\n+-----------------------------------------------------------------\n+7) Obtener todo por id\n+\n+- URL: `GET /api/todos/:id`\n+- Auth: Sí\n+- Params: `id` (MongoId)\n+- Success (200): devuelve el todo\n+- Errores: 404 NOT_FOUND, 400 INVALID_ID\n+\n+-----------------------------------------------------------------\n+8) Actualizar todo\n+\n+- URL: `PUT /api/todos/:id`\n+- Auth: Sí\n+- Body: puede incluir `title` y/o `completed`\n+\n+Ejemplo:\n+\n+```json\n+{ \"title\": \"Ir al súper\", \"completed\": true }\n+```\n+\n+- Success (200): devuelve el objeto actualizado.\n+\n+-----------------------------------------------------------------\n+9) Eliminar todo\n+\n+- URL: `DELETE /api/todos/:id`\n+- Auth: Sí\n+- Success (200): `data` contiene el objeto eliminado (útil para refrescar UI)\n+\n+-----------------------------------------------------------------\n+Errores y códigos principales\n+- 200 OK, 201 Created, 204 No Content (no usado aquí), 400 Bad Request, 401 Unauthorized, 403 Forbidden, 404 Not Found, 409 Conflict, 422 Unprocessable Entity, 500 Internal Server Error\n+- Códigos de error en el `error.code` del body: `USER_ALREADY_EXISTS`, `INVALID_CREDENTIALS`, `INVALID_TOKEN`, `NO_TOKEN`, `USER_NOT_FOUND`, `WEAK_PASSWORD`, `MISSING_FIELDS`, `MISSING_TITLE`, `NOT_FOUND`, `INVALID_ID`, `INTERNAL_ERROR`.\n+\n+Tips para el frontend\n+- Guardar token en memoria o storage (preferiblemente HttpOnly cookie si lo manejan desde backend). Si almacenan en localStorage, manejar logout y expiración.\n+- Incluir header `Authorization` en llamadas protegidas.\n+- Mostrar mensajes de validación usando `error.error.details` cuando exista.\n+- En registro/login, tras recibir token, redirigir a la app y llamar `/api/auth/profile` para obtener datos del usuario.\n+\n+Contactos\n+- Si algo no funciona, pega la request completa y la respuesta (status + body). Esto ayuda a reproducir errores rápidamente.\n+\n+Fin.\n+\n*** End Patch
